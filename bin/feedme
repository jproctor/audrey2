#!/usr/bin/ruby

require 'rubygems'
require 'audrey2'
require 'optparse'

options = {}

opts = OptionParser.new do |opts|
  opts.banner = "Usage: feedme [OPTIONS] recipes"
  
  options[:config] = '/etc/audrey2.conf'
  opts.on( '--config CONFIGFILE', "Location of config file", "(default: /etc/audrey2.conf)" )  do |f|
    options[:config] = f
  end

  opts.on_tail( '-h', '--help', 'Display this screen' ) do
    puts opts
    exit
  end

  begin 
    opts.parse! ARGV
    options
  rescue OptionParser::ParseError => e
    warn e.message
    $stderr.puts opts
    exit 1
  end
end

recipes = ARGV

if recipes.empty?
  abort "You must specify at least one recipe to feed me"
else
  audrey2 = Audrey2::Aggregator.new(options[:config])
  recipes.each { |recipe| audrey2.feed_me(recipe) }
end